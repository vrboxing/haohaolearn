#+TITLE: Pro Git

- 作者：Scott Chacon 和 Ben Straub
- 出版：Apress
  
* 1. 起步
** 1.1 关于版本控制
- VCS: version control system，版本控制系统。

** 1.2 简史
- 在Bitkeeper不再免费提供代码托管服务后，为了解决全世界Linux开发者协同工
  作的问题，Linus Torvalds于2005年4月花了三个星期开发出的世界上最优秀的
  版本控制系统。

** 1.3 基础概念
- Git与其它版本控制系统差异
  + 其它：记录每个文件的差异。
  + Git: 每个版本形成一个快照，形成快照流。
- 本地操作
  + 所有历史都记录在本地，可离线完成所有操作。
- 完整性
  + 校验和(checksum)机制计算SHA-1哈希值。
  + 存储信息使用哈希值，而不是文件名。 
- 三种状态
  + 已提交（committed）：存在于仓库目录(.git)。
  + 已修改（modified）：存在于工作目录(working directory)。
  + 已暂存（staged）: 存在于暂存区域(staging area)。

** 1.6 配置
- 配置文件
  + /etc/gitconfig: 系统配置文件
  + ~/.gitconfig: 本地配置文件
  + .git/config: 当前仓库git目录中的配置文件
- 用户信息
  + git config --global user.name "John Doe"
  + git config --global user.email johndoe@example.com
- 编辑器
  + git config --global core.editor emacs
- 检查配置信息
  + git config --list
  + git config <key>

** 1.7 获取帮助
- git help <verb>
- git <verb> --help
- man git-<verb>

* 2. Git基础
** 2.1 获得一个仓库
   - 在既有目录下初始化仓库
     + git init
   - 克隆既有仓库
     + git clone https://github.com/libgit2/libgit2

** 2.2 记录仓库变化
   - 文件状态：追踪、未追踪
   - 追踪文件：未修改、修改、暂存
   - 检查文件状态
     + git status
   - 跟踪新文件
     - git status
   - 暂存文件
     - git add <files>
   - 状态简览
     - git status -s
   - 忽略文件
     - .gitignore文件列出要忽略的文件
   - 查看已暂存和未暂存的修改
     - git diff: 比较修改之后还没有暂存起来的变化内容
   - 提交更新
     - git commit -m <msg>
   - 跳过使用暂存区域
     - git commit -m -a <msg>: 自动暂存已跟踪文件并提交
   - 移除文件
     + git rm <file>: 从暂存区和工作区中删除文件，文件不再被git管理
     + git rm --cached <file>: 从仓库中删除，即从暂存区删除，仍保留在工
       作目录中。 
   - 移动文件
     + git mv file_from file_to

** 2.3 查看提交历史
   - git log：不用参数时，按提交时间列出所有的更新，最近的更新排在最上面。
     列出每个提交的 SHA-1 校验和、作者的名字和电子邮件地址、提交时间以及
     提交说明。
   - git log -p -2: 显示每次的提交差异，显示最近2次提交。
   - git log --stat: 显示提交的统计信息。
   - git log --pretty=[子选项]: 按特定格式显示提交历史。
     + oneline: 每个提交在一行内显示
     + short, full, fuller: 展示不同程度的信息
     + format:"...": 自定义格式
   - git log --graph: 用ASCII字符串展示分支、合并历史
   - git log --since=2.weeks: 显示近2周提交
   - git log -S<function_name>: 添加或删除了某个关键字的提交
   - git log -- <dir path>: 只显示某些文件或者目录的历史提交

** 2.4 撤销操作
*** amend
    - 重新提交
#+BEGIN_SRC 
git commit -m 'initial commit'
git add forgotten_file
git commit --amend
#+END_SRC
    - 补充上的文件填加上到本次提交中，并不改变快照。

** 2.5 远程仓库使用

** Tagging

* 3. 分支
** Branches in Nutshell
** Basic Branching and Merging
** Remote Branches
   - git checkout [brachname]
   - create: git branch [branchname]
   - delete: git branch -d [branchname]
   - merge: git merge [targetbranch]
   - list branches: git branch
   - list branches with last commit : git branch -v
   - list branches merged into current branch: git branch --merged 
   - list branches not yet merged into current branch: git branch --nomerged 
** Rebasing
*** The Basic Rebase
    - git checkout experiment
    - git rebase master
    - git checkout master
    - git merge experiment
*** More Interesting Rebases
    - git rebase --onto master server client
    - git checkout master
    - git merge client
    - git rebase master server [set the base of server branch as master]
    - git checkout master
    - git merge server
*** The Perils of Rebasing
    - 


* 4. 服务器上的Git

* 5. 分式布

** Distributed Workflows

** Contributing to a Project

*** Private Small Team
    - 

*** Private Managed Team

    - Jessica建分支并推送featureA
    - 通知John下拉featureA并继续工作
    - Jessica建分支并提交featureB
    - Jessica收到Josie邮件已推送分支featureBee
    - Jessica下拉并合并featureBee到featureB
    - Jessica将featureB推送到远程featureBee上
    - 管理者合并featureA和featureBee

*** Forked Public Project

*** Public Project over Email

** Maintaining a Project


* 6. GitHub
* 7. Git工具

** 7.14 凭证存储

- Credential，即凭证。用来在本地存储用户名和密码，使得用户使用HTTP协义
  时免于输入用户名和密码。
- Git有一个所谓凭证系统的工具：
  + 默认情况下，需要用户输入用户名和系统，即无缓存模式。
  + “cache” 模式会将凭证存放在内存中一段时间。 密码永远不会被存储在磁
    盘中，并且在15分钟后从内存中清除。缓冲时间还可以人为修改。
#+BEGIN_SRC 
git config --global credential.helper cache
#+END_SRC
  + “store” 模式会将凭证用明文的形式存放在磁盘中，并且永不过期。 这意
    味着除非你修改了你在 Git 服务器上的密码，否则你永远不需要再次输入你
    的凭证信息。 这种方式的缺点是你的密码是用明文的方式存放在你的 home
    目录下。
#+BEGIN_SRC 
git config --global credential.helper store
#+END_SRC

- "cache"模式
  + --timeout <seconds>
    设置后台进程的存活时间。
  + 实际操作
    1. 设置缓冲模式: git config --global credential.helper cache
    2. 正常执行下拉或推送，输入用户名和密码。Git系统将在存活时间内记住该
       凭证信息。
  
- "store"模式

  + --file <path>
    明文文件默认为~/.git-credentials，也可以定义为其它文件。

  + 凭证信息格式
    * 用户名：密码@宿主位置
    * https://bob:s3cre7@mygithost
    * 一般宿主位置为：github.com

  + 实际操作
    1. 建立一个凭证明文文件，如.git-credentials。输入凭证信息：如https://bob.s4cre7@mygithost
    2. 设置凭证模式：git config --global credential.helper store 
